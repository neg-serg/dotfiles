{pkgs, lib, config, ...}: let
  # Exclude any package whose pname (or parsed name) is listed in features.excludePkgs
  excluded = config.features.excludePkgs or [];
  notExcluded = p: let n = (p.pname or (lib.getName p)); in !(lib.elem n excluded);
  notBroken = p: !(((p.meta or {}).broken or false));
in {
  # Auto-skip broken packages, and allow user-defined exclusions without editing lists.
  home.packages =
    lib.filter notBroken (
      lib.filter notExcluded (
        with pkgs; [
          bettercap # The Swiss Army knife for 802.11, BLE and Ethernet networks reconnaissance and MITM attacks
          dsniff # Collection of tools for network auditing and penetration testing.
          mitmproxy # An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers
          rshijack # TCP connection hijacker
          sipp # Protocol testing tool
          sniffglue # Secure multithreaded packet sniffer
        ]
      )
    );
}
