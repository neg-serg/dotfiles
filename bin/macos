#!/usr/bin/env bash

qemu-system-x86_64 \
    -enable-kvm \
    -m 6G -cpu Penryn,kvm=on,vendor=GenuineIntel,+invtsc,vmware-cpuid-freq=on,+ssse3,+sse4.2,+popcnt,+avx,+aes,+xsave,+xsaveopt,check \
    -machine q35 \
    -usb -device usb-kbd -device usb-tablet -device usb-tablet \
    -smp 4,cores=2,sockets=1 \
    -device usb-ehci,id=ehci \
    -device nec-usb-xhci,id=xhci \
    -global nec-usb-xhci.msi=off -device 'isa-applesmc,osk=ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc' \
    -drive if=pflash,format=raw,readonly=on,file=/zero/virt/OVMF_CODE.fd \
    -drive if=pflash,format=raw,readonly=on,file=/zero/virt/OVMF_VARS-1920x1080.fd \
    -smbios type=2 -device ich9-intel-hda -device hda-duplex \
    -drive id=OpenCoreBoot,if=virtio,snapshot=on,readonly=on,format=qcow2,file=/zero/virt/OpenCore.qcow2 \
    -drive id=MacHDD,if=virtio,file=/zero/virt/macos-ventura.qcow2,format=qcow2 \
    -netdev user,id=net0,hostfwd=tcp:127.0.0.1:2222-:22 \
    -device virtio-net-pci,netdev=net0,id=net0
