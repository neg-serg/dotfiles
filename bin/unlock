#!/bin/sh
. /etc/profile
pp1="$(pass show ssh-key)"
pp2="$(pass show sk)"
if lsusb | grep -q "0407 Yubico"; then
    pp3="$(pass show pin)"
    expect << EOF
        spawn "$XDG_CONFIG_HOME/zsh-nix/ylock"
        expect "Enter passphrase"
        send "$pp3\r"
        expect eof
EOF
fi
expect << EOF
    spawn ssh-add $HOME/.ssh/id_neg
    expect "Enter passphrase"
    send "$pp1\r"
    spawn ssh-add $HOME/.ssh/neg_ed25519_sk
    expect "Enter passphrase"
    send "$pp2\r"
    expect eof
EOF
